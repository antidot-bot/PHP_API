<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Antidot PHP API: AFS filter expressions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-antidot-long-200x41.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Antidot PHP API
   &#160;<span id="projectnumber">version 0.9.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AFS filter expressions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#afe_introduction">Introduction</a></li>
<li class="level1"><a href="#afe_basics">Simple filter expressions</a><ul><li class="level2"><a href="#afeb_id">Filter identifier</a></li>
<li class="level2"><a href="#afeb_operators">Filter operators</a></li>
<li class="level2"><a href="#afeb_value">Filter value</a></li>
</ul>
</li>
<li class="level1"><a href="#afe_advanced">Advanced filter expressions</a><ul><li class="level2"><a href="#afea_combine_filter">Combine simple filter expressions</a></li>
<li class="level2"><a href="#afea_group_filter">Group filter expressions</a></li>
</ul>
</li>
<li class="level1"><a href="#afe_special">Special notes</a><ul><li class="level2"><a href="#afes_date_format">Date format</a></li>
<li class="level2"><a href="#afes_filter_builder_example">Example of filter builder</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="afe_introduction"></a>
Introduction</h1>
<p>This page introduces filter expressions. They are usefull to define AFS search engine queries.</p>
<h1><a class="anchor" id="afe_basics"></a>
Simple filter expressions</h1>
<p>To filter on specific facet value, one must define following elements:</p>
<ul>
<li>facet identifier to use as filter,</li>
<li>operator used to compare facet value of each document/product to the specified one,</li>
<li>and, finally, facet value to be compared with the one defined in each document/product.</li>
</ul>
<p>These elements must be defined in this order and none can be omitted.</p>
<h2><a class="anchor" id="afeb_id"></a>
Filter identifier</h2>
<p>Filter identifier is created using the helper function <em><a class="el" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59" title="Helper function to create new AfsFilter instance. ">filter()</a></em>. It is also possible to create it using other method which is detailled later (see <a class="el" href="afs_filter_expr.html#afea_combine_filter">Combine simple filter expressions</a>).</p>
<p>For example, you can define a filter on the categorie identified by <code>MATERIAL</code> as following: </p>
<div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>) </div>
</div><!-- fragment --><h2><a class="anchor" id="afeb_operators"></a>
Filter operators</h2>
<p>Operators must be used on filter identifiers. One operator, and only one, can be applied to one defined filter identifier.</p>
<p>Operators define the way provided facet values are compared with values defined by each document/product.</p>
<p>Standard operators are available. Here is the list of all available operators:</p>
<ul>
<li><code>equal:</code> equal to comparison,</li>
<li><code>not_equal:</code> not equal to comparison,</li>
<li><code>less:</code> less than comparison,</li>
<li><code>less_equal:</code> less than or equal to comparison,</li>
<li><code>greater:</code> greater than comparison,</li>
<li><code>greater_equal:</code> greater than or equal to comparison.</li>
</ul>
<p>Here are examples for some of the operators: </p>
<div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal </div>
</div><!-- fragment --> <div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;less_equal </div>
</div><!-- fragment --><h2><a class="anchor" id="afeb_value"></a>
Filter value</h2>
<p>Values must be defined on filter operators. One value, and only one, can be applied to one filter operator.</p>
<p>Allowed value types are:</p>
<ul>
<li><code>string:</code> it may be a string value surrounded by double quotes (<code>"</code>) or a string representation of an integer, float, boolean or date value,</li>
<li><code>integer</code>,</li>
<li><code>float</code>,</li>
<li><code>boolean</code>.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Date values must be defined as <code>string</code> value with appropriate format. See <a class="el" href="afs_filter_expr.html#afes_date_format">Date format</a> for more details.</dd></dl>
<p>Here are examples of AFS search engine filter definitions along with their corresponding expressions:</p>
<ul>
<li><code>MATERIAL="copper"</code> <div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal-&gt;(<span class="stringliteral">&#39;&quot;copper&quot;&#39;</span>); </div>
</div><!-- fragment --></li>
<li><code>PRICE=42.666</code> <div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;less_equal(42.666); </div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="afe_advanced"></a>
Advanced filter expressions</h1>
<p>Filter expressions, like the ones defined earlier (ID-&gt;operator-&gt;value), can be combined or grouped in order to build complex filter expressions.</p>
<h2><a class="anchor" id="afea_combine_filter"></a>
Combine simple filter expressions</h2>
<p>Combination should be defined on simple filter expressions or groups (for details on groups, see below <a class="el" href="afs_filter_expr.html#afea_group_filter">Group filter expressions</a>).</p>
<p>Simple filter expressions can be combined in order to make a new filter expression. Two combination types are available:</p>
<ul>
<li><code>and:</code> Filter expressions on both sides of the <code>and</code> operator must be verified for a document/product to make it appears in AFS search engine reply.</li>
<li><code>or:</code> At least one filter expression on whichever side of the <code>or</code> operator must be verified for a document/product to make it appears in AFS search engine reply.</li>
</ul>
<p>This is really usefull when you want to filter on multiple values for specific facet. This is also true when you want to build intervals. Here are examples of such conditions:</p>
<ul>
<li><code>MATERIAL="copper" or MATERIAL="gold"</code> <div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal-&gt;(<span class="stringliteral">&#39;&quot;copper&quot;&#39;</span>)-&gt;or-&gt;filter(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal-&gt;value(<span class="stringliteral">&#39;&quot;gold&quot;&#39;</span>) </div>
</div><!-- fragment --></li>
<li><code>PRICE&lt;=42.666 or PRICE&gt;12.3</code> <div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;less_equal-&gt;(42.666)-&gt;or-&gt;filter(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;greater-&gt;value(12.3) </div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="afea_group_filter"></a>
Group filter expressions</h2>
<p>Grouping filter expressions defines priority for combined expressions.</p>
<p>Group expression is created with <em><a class="el" href="afs__group__filter_8php.html#ab7106d8ea108e2ea7880995a9642541b" title="Helper function to create new AfsGroup instance. ">group()</a></em> function. Usage example follows:</p>
<ul>
<li><code>(MATERIAL="copper" and PRICE&lt;42.666) or (MATERIAL="gold" and PRICE&lt;=123.456)</code> <div class="fragment"><div class="line"><a class="code" href="afs__group__filter_8php.html#ab7106d8ea108e2ea7880995a9642541b">group</a>(<a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal-&gt;(<span class="stringliteral">&#39;&quot;copper&quot;&#39;</span>)-&gt;and-&gt;filter(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;less_equal-&gt;(42.666))-&gt;or-&gt;group(<a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal-&gt;value(<span class="stringliteral">&#39;&quot;gold&quot;&#39;</span>)-&gt;and-&gt;filter(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;less_equal-&gt;(123.456)); </div>
</div><!-- fragment --></li>
<li><code>MATERIAL="platinium" or (MATERIAL="gold" and PRICE&gt;345)</code> <div class="fragment"><div class="line"><a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(MATERIAL)-&gt;equal-&gt;value(<span class="stringliteral">&#39;&quot;platinium&quot;&#39;</span>)-&gt;or-&gt;group(<a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>(<span class="stringliteral">&#39;MATERIAL&#39;</span>)-&gt;equal-&gt;value(<span class="stringliteral">&#39;&quot;gold&quot;&#39;</span>)-&gt;and-&gt;filter(<span class="stringliteral">&#39;PRICE&#39;</span>)-&gt;cwgreaterless_equal-&gt;(345)); </div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="afe_special"></a>
Special notes</h1>
<h2><a class="anchor" id="afes_date_format"></a>
Date format</h2>
<p>Date value should match one of the following formats:</p>
<ul>
<li><code>yyyy-MM-dd HH:mm</code></li>
<li><code>yyyy-MM-dd HH</code></li>
<li><code>yyyy-MM-dd</code></li>
<li><code>yyyy-MM</code></li>
<li><code>yyyy</code></li>
</ul>
<p>with:</p>
<ul>
<li><code>yyyy:</code> represents years,</li>
<li><code>MM:</code> represents months (with leading 0 when necessary),</li>
<li><code>dd:</code> represents days (with leading 0 when necessary),</li>
<li><code>HH:</code> represents hours (with leading 0 when necessary),</li>
<li><code>mm:</code> represents minutes (with leading 0 when necessary),</li>
</ul>
<p>For more details on date format and their usage, please refer to AFS search engine documentation.</p>
<h2><a class="anchor" id="afes_filter_builder_example"></a>
Example of filter builder</h2>
<p>It can happen that one wants to create several filters of the same type. In such case, it may be tedious to write appropriate filter expressions for each filter. So you are encouraged to make your own function to create appropriate filter expressions.</p>
<p>For example, let's suppose you often want to combine multiple values for specific facet identifier. List of facet values can be transfered as array to your specific function. Here is an example of such function: </p>
<div class="fragment"><div class="line"><span class="keyword">function</span> myExpressionBuilder($id, array $values)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (empty($values))</div>
<div class="line">        <span class="keywordflow">return</span> null;</div>
<div class="line"></div>
<div class="line">    $value = array_shift($values);</div>
<div class="line">    $result = <a class="code" href="afs__filter_8php.html#af79b692968a5d4fc4175fa1c373b0b59">filter</a>($id)-&gt;equal-&gt;value($value);</div>
<div class="line">    <span class="keywordflow">while</span> (! empty($values))</div>
<div class="line">        $result = $result-&gt;or-&gt;filter($id)-&gt;equal-&gt;value(array_shift($values));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $result;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Previous function definition will help you build following filter expressions:</p>
<ul>
<li><code>MATERIAL="copper"</code> <div class="fragment"><div class="line">myExpressionBuilder(<span class="stringliteral">&#39;MATERIAL&#39;</span>, array(<span class="stringliteral">&#39;&quot;copper&quot;&#39;</span>)); </div>
</div><!-- fragment --></li>
<li><code>MATERIAL="copper" or MATERIAL="silver" or MATERIAL="gold"</code> <div class="fragment"><div class="line">myExpressionBuilder(<span class="stringliteral">&#39;MATERIAL&#39;</span>, array(<span class="stringliteral">&#39;&quot;copper&quot;&#39;</span>, <span class="stringliteral">&#39;&quot;silver&quot;&#39;</span>, <span class="stringliteral">&#39;&quot;gold&quot;&#39;</span>)); </div>
</div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 17 2014 15:54:54 for Antidot PHP API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
